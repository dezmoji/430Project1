<!DOCTYPE html>
<html lang="en">
<head>
  <title>Untitled Project 1</title>
  <link rel="stylesheet" type="text/css" href="/style.css">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
  <script type="text/babel">
    const parseJSON = (xhr, content, list) =>{
        const obj = JSON.parse(xhr.response);
      
      if(list === false) {
        const div = document.createElement('div')
        const h = document.createElement('h1')
        const p = document.createElement('p');
        div.appendChild(h);
        div.appendChild(p);
        h.textContent = `${obj.task}`
        p.textContent = `${obj.desc}`;
        content.appendChild(div);
      }
    
      else{
        let id = 0;
        while(obj.taskList[id]){
            const div = document.createElement('div')
            const h = document.createElement('h1')
            const p = document.createElement('p');
            div.appendChild(h);
            div.appendChild(p);
            h.textContent = `${obj.taskList[id].task}`
            p.textContent = `${obj.taskList[id].desc}`;
            content.appendChild(div);
            id++;
        };
      }
    };

    const handleResponse = (xhr,method) => {
        const content = document.querySelector('#content');
        if (method === 'POST'){
            parseJSON(xhr,content,false);
        }
        else{
            parseJSON(xhr, content, true);
        }
    };

    const sendPost = (e,form) =>{ 
        const xhr = new XMLHttpRequest();
        const method = form.getAttribute('method');
        if(method === 'POST'){
            const formAction = form.getAttribute('action');
            const taskField = form.querySelector('#task');
            const descField = form.querySelector('#desc');
            xhr.open(method, formAction);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.setRequestHeader('Accept', 'application/json');
            xhr.onload = () => handleResponse(xhr, method);
            const formData = `task=${taskField.value}&desc=${descField.value}`;
            xhr.send(formData);
            e.preventDefault();
            return false;
        }
    };

    const sendGet = (method,path) =>{
        const xhr = new XMLHttpRequest();
        xhr.open(method,path)
        xhr.setRequestHeader('Accept', 'application/json');
        xhr.onload = () => handleResponse(xhr, 'GET');
        xhr.send();
        return false;
    };

    const init = () => {
        sendGet('GET','/getTasks');
        const taskForm = document.querySelector('#taskForm');
        const addTask = (e) => sendPost(e, taskForm);
        taskForm.addEventListener('submit', addTask);
    };
    window.onload = init;
  </script>
</head>
<body>
    <form method="POST" action="/addTask" id="taskForm">
        Task: <input type="text" id="task" required="true" name="task" autofocus="true">
        <br>
        Description: 
        <br>
        <textarea rows="4" cols="50" id="desc" name="desc" form="taskForm" required="true"></textarea>
        <br>
        <input type="submit">
    </form>

    
    <section id="content">

    </section>
</body>
</html>