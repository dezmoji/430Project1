<!DOCTYPE html>
<html lang="en">
<head>
  <title>Untitled Project 1</title>
  <link rel="stylesheet" type="text/css" href="/style.css">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
  <script type="text/babel">
    const parseJSON = (xhr, content, list) =>{
        const obj = JSON.parse(xhr.response);
        console.log(obj);
      
      if((obj.topic || obj.note) && list === false) {
        const div = document.createElement('div')
        const h = document.createElement('h1')
        const p = document.createElement('p');
        div.appendChild(h1);
        div.appendChild(p);
        h.textContent = `${obj.topic}`
        p.textContent = `${obj.note}`;
        content.appendChild(div);
      }
    
      else{
        let id = 0;
        console.log(obj[id]);
        //console.log(obj[id]);
            //console.log(obj[id].topic);
            //console.log(obj[id].noteList);
          //  console.log(obj.noteList[id]);
        while(obj[id]){
            
            const div = document.createElement('div')
            const h = document.createElement('h1')
            const p = document.createElement('p');
            div.appendChild(h1);
            div.appendChild(p);
            h.textContent = `${obj[id].topic}`
            p.textContent = `${obj[id].note}`;
            content.appendChild(div);
            id++;
        };
      }
    };

    const handleResponse = (xhr,method) => {
        const content = document.querySelector('#content');
        if (method === 'POST'){
            parseJSON(xhr,content,false);
        }
        else{
            parseJSON(xhr, content, true);
        }
    };

    const sendPost = (e,form) =>{ 
        const xhr = new XMLHttpRequest();
        const method = form.getAttribute('method');
        if(method === 'POST'){
            const formAction = form.getAttribute('action');
            const topicField = form.querySelector('#topic');
            const noteField = form.querySelector('#note');
            xhr.open(method, formAction);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.setRequestHeader('Accept', 'application/json');
            xhr.onload = () => handleResponse(xhr, method);
            const formData = `topic=${topicField.value}&note=${noteField.value}`;
            xhr.send(formData);
            e.preventDefault();
            return false;
        }
    };

    const sendGet = (method,path) =>{
        const xhr = new XMLHttpRequest();
        xhr.open(method,path)
        xhr.setRequestHeader('Accept', 'application/json');
        xhr.onload = () => handleResponse(xhr, 'GET');
        xhr.send();
        return false;
    };

    const init = () => {
        const noteForm = document.querySelector('#noteForm');
        const addNote = (e) => sendPost(e, noteForm);
        noteForm.addEventListener('submit', addNote);
        sendGet('GET','/getNotes');
    };
    window.onload = init;
  </script>
</head>
<body>
    <form method="POST" action="/addNote" id="noteForm">
        Topic: <input type="text" id="topic" required="true" name="topic" autofocus="true">
        <input type="submit">
    </form>
    <br>
    <textarea rows="4" cols="50" id="note" name="note" form="noteForm" required="true"></textarea>
    <section id="notes">

    </section>
</body>
</html>